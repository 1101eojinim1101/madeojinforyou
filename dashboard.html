<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>학생 대시보드</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      display: flex;
      height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    /* 사이드바 */
    nav {
      width: 180px;
      background: #b3e5fc;
      display: flex;
      flex-direction: column;
    }
    nav a {
      padding: 1rem;
      color: #333;
      text-decoration: none;
      cursor: pointer;
    }
    nav a:hover, nav a.active {
      background: #81d4fa;
    }
    /* 콘텐츠 영역 */
    .content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
    h2 {
      margin-bottom: 1rem;
      color: #333;
    }
    p {
      line-height: 1.5;
    }
  </style>
</head>
<body>

  <!-- 좌측 메뉴 -->
  <nav id="sidebar">
    <a data-target="info"   class="active">나의 정보</a>
    <a data-target="secret">비밀 친구</a>
    <a data-target="learning">배움 정리</a>
    <a data-target="footprint">나의 발자국</a>
    <a data-target="teacher">선생님의 기록</a>
    <a data-target="growth">성장 기록지</a>
  </nav>

  <!-- 우측 콘텐츠 -->
   <!-- ====== 나의 정보 섹션 시작 ====== -->
<div id="info" class="section active">
  <h2>나의 정보</h2>

  <div id="infoForm" style="margin-top:2rem; max-width:400px;">
    <h3><span id="selectedName"></span>님의 정보</h3>

    <!-- 프로필 사진 업로드 & 미리보기 -->
    <div class="photo-container">
      <img id="profilePreview" alt="프로필 사진 미리보기" />
      <label for="photoUpload" class="photo-label">프로필 사진 선택</label>
      <input type="file" id="photoUpload" accept="image/png, image/jpeg" style="display:none" />
    </div>

    <!-- 정보 입력란 -->
    <input id="birthday"  type="date"     style="width:100%; margin-bottom:0.5rem; padding:0.5rem;" />
    <input id="mbti"      type="text"     placeholder="MBTI"                  style="width:100%; margin-bottom:0.5rem; padding:0.5rem;" />
    <input id="account"   type="text"     placeholder="수학탐험대 계정"        style="width:100%; margin-bottom:0.5rem; padding:0.5rem;" />
    <input id="accountPw" type="text"     placeholder="수학탐험대 비밀번호"    style="width:100%; margin-bottom:0.5rem; padding:0.5rem;" />
    <input id="hobby"     type="text"     placeholder="취미"                  style="width:100%; margin-bottom:0.5rem; padding:0.5rem;" />
    <input id="interest"  type="text"     placeholder="흥미"                  style="width:100%; margin-bottom:0.5rem; padding:0.5rem;" />
    <input id="skill"     type="text"     placeholder="특기"                  style="width:100%; margin-bottom:0.5rem; padding:0.5rem;" />
    <input id="dream"     type="text"     placeholder="장래희망"              style="width:100%; margin-bottom:1rem; padding:0.5rem;" />

    <button id="saveInfo" style="width:100%; padding:0.75rem; background:#64b5f6; color:#fff; border:none; border-radius:6px; cursor:pointer;">
      저장하기
    </button>
  </div>
</div>
<!-- ====== 나의 정보 섹션 끝 ====== -->

<style>
  /* 프로필 사진 컨테이너 */
  .photo-container {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto 1rem;
    border-radius: 50%;
    overflow: hidden;
    background: #f0f0f0;
    border: 1px solid #ccc;
  }
  .photo-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .photo-label {
    display: block;
    text-align: center;
    margin-top: 0.5rem;
    color: #007bff;
    cursor: pointer;
  }
</style>

<script>
  // 페이지 로드 시 로그인 확인 및 정보 로드
  document.addEventListener('DOMContentLoaded', () => {
    const studentId = localStorage.getItem('studentId');
    if (!studentId) return location.href = 'index.html';

    document.getElementById('selectedName').innerText = studentId;
    document.getElementById('infoForm').style.display = 'block';

    const data = JSON.parse(localStorage.getItem('info_' + studentId) || '{}');
    if (data.photo) document.getElementById('profilePreview').src = data.photo;
    ['birthday','mbti','account','accountPw','hobby','interest','skill','dream'].forEach(key => {
      if (data[key]) document.getElementById(key).value = data[key];
    });
  });

  // 사진 업로드 & 미리보기
  document.getElementById('photoUpload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => document.getElementById('profilePreview').src = ev.target.result;
    reader.readAsDataURL(file);
  });

  // 정보 저장하기
  document.getElementById('saveInfo').addEventListener('click', () => {
    const studentId = localStorage.getItem('studentId');
    if (!studentId) return alert('로그인 후 이용하세요.');

    const obj = {
      photo: document.getElementById('profilePreview').src,
      birthday: document.getElementById('birthday').value,
      mbti: document.getElementById('mbti').value,
      account: document.getElementById('account').value,
      accountPw: document.getElementById('accountPw').value,
      hobby: document.getElementById('hobby').value,
      interest: document.getElementById('interest').value,
      skill: document.getElementById('skill').value,
      dream: document.getElementById('dream').value,
    };
    localStorage.setItem('info_' + studentId, JSON.stringify(obj));
    alert('나의 정보가 저장되었습니다.');
  });
</script>

  <div class="content">

<!-- ====== 비밀 친구 섹션 시작 ====== -->
<div id="secret" class="section">
  <!-- 서브탭 -->
  <div class="subtabs">
    <button class="subtab active" data-target="attendance">감정 출석부</button>
    <button class="subtab"       data-target="diary">일기 쓰기</button>
  </div>

  <div class="subcontent">
    <!-- 감정 출석부 -->
    <div id="attendance" class="subsection active">
      <h3>감정 출석부 – <span id="attDate"></span></h3>
      <div class="emotion-grid"></div>

      <div id="attReason" class="attendance-reason" style="display:none;">
        <input id="reasonInput"
               type="text" maxlength="20"
               placeholder="네 마음의 이유가 궁금해. 나에게만 알려줘🤫"
               style="width:100%; margin-bottom:0.5rem; padding:0.5rem;" />
        <button id="checkBtn"
                style="padding:0.6em 1.2em;
                       background:#64b5f6; color:#fff;
                       border:none; border-radius:6px;
                       cursor:pointer;">
          출석 체크
        </button>
      </div>

      <h4 style="margin-top:1.5rem;">출석 기록</h4>
      <ul id="attendanceList"
          style="list-style:none; padding:0; margin-top:0.5rem;">
      </ul>
    </div>

    <!-- 일기 쓰기 -->
    <div id="diary" class="subsection">
      <div class="diary-header"
           style="display:flex;
                  justify-content:space-between;
                  align-items:center;
                  margin-bottom:1rem;">
        <h3>일기 쓰기</h3>
        <button id="newDiaryBtn"
                style="padding:0.5rem 1rem;
                       background:#64b5f6; color:#fff;
                       border:none; border-radius:6px;
                       cursor:pointer;">
          새 일기 쓰기
        </button>
      </div>

      <!-- 1) 일기 목록 -->
      <div id="diaryList" class="diary-list"></div>

      <!-- 2) 새 일기 쓰기 폼 -->
      <div id="diaryForm" class="diary-form"
           style="display:none; max-width:500px; margin-bottom:1rem;">
        <input id="diaryDate"
               type="date"
               style="width:100%; margin-bottom:0.5rem; padding:0.5rem;" />
        <select id="diaryEmotion"
                style="width:100%; margin-bottom:0.5rem; padding:0.5rem;">
        </select>
        <textarea id="diaryText" rows="6"
                  placeholder="네 마음과 경험을 솔직하게 써봐. 너를 평가하거나 판단하지 않을게. 조용히 듣고있다가, 네가 원할 때 필요한 조언을 해줄게."
                  style="width:100%; padding:0.5rem; margin-bottom:0.5rem;"></textarea>
        <button id="saveDiaryBtn"
                style="padding:0.6em 1.2em;
                       background:#64b5f6; color:#fff;
                       border:none; border-radius:6px;
                       cursor:pointer;">
          저장
        </button>
      </div>

      <!-- 3) 일기 보기 -->
      <div id="diaryView" class="diary-view"
           style="display:none; max-width:500px;">
        <button id="backDiaryBtn"
                style="margin-bottom:1rem;
                       padding:0.4rem 0.8rem;
                       background:#aaa; color:#fff;
                       border:none; border-radius:4px;
                       cursor:pointer;">
          목록으로
        </button>
        <h4>날짜: <span id="viewDate"></span></h4>
        <p>감정: <span id="viewEmotion"></span></p>
        <h5>📝 원본</h5><p id="viewOriginal"></p>
        <h5>💡 AI 제안</h5><p id="viewAI">없음</p>
        <h5>✅ 최종</h5><p id="viewFinal">없음</p>
      </div>
    </div>
  </div>
</div>
<!-- ====== 비밀 친구 섹션 끝 ====== -->

<style>
  .subtabs {
    display: flex; border-bottom:2px solid #ddd; margin-bottom:1rem;
  }
  .subtab {
    flex:1; padding:0.75rem; background:none; border:none;
    border-bottom:3px solid transparent; font-size:1rem; cursor:pointer;
  }
  .subtab.active {
    border-color:#64b5f6; color:#64b5f6;
  }
  .subcontent .subsection { display:none; }
  .subcontent .subsection.active { display:block; }

  .emotion-grid {
    display:grid; grid-template-columns:repeat(5,1fr); gap:0.75rem; margin-bottom:1rem;
  }
  .emotion-cell {
    display:flex; flex-direction:column; align-items:center;
    padding:0.75rem; border:1px solid #ccc; border-radius:8px; cursor:pointer;
    transition:background .2s, border-color .2s;
  }
  .emotion-cell.selected {
    background:rgba(100,181,246,0.2); border-color:#64b5f6;
  }

  .diary-list button {
    display:block; width:100%; text-align:left; padding:0.5rem; margin-bottom:0.25rem;
    border:1px solid #ccc; background:#fff; cursor:pointer; border-radius:4px;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const studentId = localStorage.getItem('studentId');
  if (!studentId) return location.href='index.html';

  // 오늘 날짜
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('attDate').innerText = today;

  // 탭 전환
  document.querySelectorAll('.subtab').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.subtab').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.subsection').forEach(sec=>sec.classList.remove('active'));
      document.getElementById(btn.dataset.target).classList.add('active');
    });
  });

  // 감정 목록
  const emotions = [
    {emoji:'😀',label:'기쁨'},{emoji:'😄',label:'행복'},{emoji:'😍',label:'사랑'},
    {emoji:'😌',label:'차분'},{emoji:'😂',label:'재미'},{emoji:'🤩',label:'설렘'},
    {emoji:'😊',label:'만족'},{emoji:'😉',label:'장난'},{emoji:'😜',label:'유쾌'},
    {emoji:'😐',label:'평범'},{emoji:'😞',label:'슬픔'},{emoji:'😭',label:'눈물'},
    {emoji:'😡',label:'화남'},{emoji:'😱',label:'공포'},{emoji:'😴',label:'피곤'},
    {emoji:'🤔',label:'고민'},{emoji:'😕',label:'혼란'},{emoji:'😏',label:'자신감'},
    {emoji:'😔',label:'우울'},{emoji:'😓',label:'스트레스'},{emoji:'😇',label:'안도'},
    {emoji:'🤗',label:'친근'},{emoji:'🤒',label:'아픔'},{emoji:'😶',label:'무감각'},
    {emoji:'🙏',label:'감사'}
  ];

  // 출석 기록 로드
  function loadAttendance() {
    const list = document.getElementById('attendanceList');
    list.innerHTML = '';
    const prefix = `attendance_${studentId}_`;
    Object.keys(localStorage)
      .filter(key => key.startsWith(prefix))
      .sort()
      .forEach(key => {
        const { emoji, label, reason } = JSON.parse(localStorage.getItem(key));
        const date = key.replace(prefix, '');
        const li = document.createElement('li');
        li.style.padding = '0.4rem 0';
        li.innerText = `${date} – ${emoji} ${label} – ${reason}`;
        list.appendChild(li);
      });
    // TODO: 서버 연동 가능 지점
  }

  // 감정 그리드 생성
  const grid = document.querySelector('.emotion-grid');
  emotions.forEach(({emoji,label}) => {
    const cell = document.createElement('div');
    cell.className = 'emotion-cell';
    cell.innerHTML = `<div class="emo-emoji">${emoji}</div><div>${label}</div>`;
    grid.appendChild(cell);
    cell.addEventListener('click', () => {
      document.querySelectorAll('.emotion-cell').forEach(c=>c.classList.remove('selected'));
      cell.classList.add('selected');
      document.getElementById('attReason').style.display = 'block';
      document.getElementById('attReason').scrollIntoView({ behavior:'smooth' });
      // 기본 감정 저장
      const key = `attendance_${studentId}_${today}`;
      localStorage.setItem(key, JSON.stringify({ emoji, label }));
    });
  });

  // 출석 체크
  document.getElementById('checkBtn').addEventListener('click', () => {
    const sel = document.querySelector('.emotion-cell.selected');
    const reason = document.getElementById('reasonInput').value.trim();
    if (!sel) return alert('감정을 선택하세요.');
    if (!reason) return alert('이유를 작성하세요.');
    const key = `attendance_${studentId}_${today}`;
    const base = JSON.parse(localStorage.getItem(key));
    localStorage.setItem(key, JSON.stringify({ ...base, reason }));
    alert('출석 체크 완료!');
    sel.classList.remove('selected');
    document.getElementById('reasonInput').value = '';
    document.getElementById('attReason').style.display = 'none';
    loadAttendance();
  });

  // 일기 탭 로직
  const diaryList   = document.getElementById('diaryList');
  const diaryForm   = document.getElementById('diaryForm');
  const diaryView   = document.getElementById('diaryView');
  const newBtn      = document.getElementById('newDiaryBtn');
  const formDate    = document.getElementById('diaryDate');
  const formEmo     = document.getElementById('diaryEmotion');
  const formText    = document.getElementById('diaryText');
  const saveDiary   = document.getElementById('saveDiaryBtn');
  const backDiary   = document.getElementById('backDiaryBtn');

  // 감정 옵션 채우기
  emotions.forEach(({emoji,label}) => {
    const o = document.createElement('option');
    o.value = label;
    o.innerText = `${emoji} ${label}`;
    formEmo.appendChild(o);
  });

  function loadDiaryList() {
    diaryList.innerHTML = '';
    const prefix = `diary_${studentId}_`;
    Object.keys(localStorage)
      .filter(k => k.startsWith(prefix))
      .sort().reverse()
      .forEach(k => {
        const { date, emotion, text } = JSON.parse(localStorage.getItem(k));
        const btn = document.createElement('button');
        btn.innerText = `${date} – ${text.slice(0,8)}...`;
        btn.addEventListener('click', () => viewEntry(k));
        diaryList.appendChild(btn);
      });
  }

  function viewEntry(key) {
    const data = JSON.parse(localStorage.getItem(key));
    diaryList.style.display = 'none';
    diaryForm.style.display = 'none';
    diaryView.style.display = 'block';
    document.getElementById('viewDate').innerText    = data.date;
    document.getElementById('viewEmotion').innerText = data.emotion;
    document.getElementById('viewOriginal').innerText= data.text;
    document.getElementById('viewAI').innerText       = data.aiSuggestion || '없음';
    document.getElementById('viewFinal').innerText    = data.finalContent || '없음';
  }

  newBtn.addEventListener('click', () => {
    diaryList.style.display = 'none';
    diaryView.style.display = 'none';
    diaryForm.style.display = 'block';
    formDate.value = today;
    const att = JSON.parse(localStorage.getItem(`attendance_${studentId}_${today}`) || '{}');
    formEmo.value = att.label || '';
    formText.value = '';
  });

  saveDiary.addEventListener('click', () => {
    const date    = formDate.value;
    const emotion = formEmo.value;
    const text    = formText.value.trim();
    if(!date||!emotion||!text) return alert('모든 항목을 입력하세요.');
    const key = `diary_${studentId}_${date}_${Date.now()}`;
    localStorage.setItem(key, JSON.stringify({
      date, emotion, text, aiSuggestion:'', finalContent:''
    }));
    alert('일기 저장 완료!');
    diaryForm.style.display = 'none';
    loadDiaryList();
    diaryList.style.display = 'block';
  });

  backDiary.addEventListener('click', () => {
    diaryView.style.display = 'none';
    diaryForm.style.display = 'none';
    diaryList.style.display = 'block';
  });

  // 초기 로드
  loadAttendance();
  loadDiaryList();
});
</script>




    <div id="learning" class="section">
      <h2>배움 정리</h2>
      <p>여기에 수업별 배움 정리 폼을 넣을 수 있습니다.</p>
    </div>
    <div id="footprint" class="section">
      <h2>나의 발자국</h2>
      <p>여기에 나의 학습 활동 로그나 사진 등이 표시됩니다.</p>
    </div>
    <div id="teacher" class="section">
      <h2>선생님의 기록</h2>
      <p>선생님이 작성한 피드백이나 코멘트를 보여줍니다.</p>
    </div>
    <div id="growth" class="section">
      <h2>성장 기록지</h2>
      <p>분기별 성장 보고서 및 그래프 등을 표시합니다.</p>
    </div>
  </div>

  <script>
    const links = document.querySelectorAll('nav a');
    const sections = document.querySelectorAll('.section');
    links.forEach(link => {
      link.addEventListener('click', () => {
        // 메뉴 active 토글
        links.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        // 섹션 active 토글
        sections.forEach(s => s.classList.remove('active'));
        document.getElementById(link.dataset.target).classList.add('active');
      });
    });
  </script>

</body>
</html>
